---
description: Always-on guardrails for persistence, planning, and continuity across sessions
alwaysApply: true
---

# SESSION CONTINUITY & PERSISTENCE

You MUST maintain and use these persistent files in the repo root:

- PLAN.md — The current project plan and next 3 concrete tasks.
- DECISIONS.log — Chronological log of key choices (date, reason, file(s) touched).
- TODO.md — Granular task list; check items off as you complete them.
- ARCH.md — Architecture overview (backend, frontend, agents, queues, infra).
- RULES-INDEX.md — A short index pointing to these docs and any project-specific rules.

**On first run (or if any file is missing), create them with sensible defaults.**
**At the start of every significant action**, do all of the following:
1) Read PLAN.md + DECISIONS.log + ARCH.md.
2) Post a 2–4 line “Context Recap” in chat: the current goal + next action.
3) If the plan changes, update PLAN.md and append to DECISIONS.log (what/why).

**When returning after inactivity**, ALWAYS re-read those files and summarize the current state before editing.

# EDITING PRINCIPLES

- Preserve existing logic and conditions; DO NOT remove branches or else-clauses unless explicitly told.
- Minimize diff surface; prefer focused changes.
- Before/after snippets for risky edits; explain why the change is safe.

# PRAGMATICS

- Prefer small, iterative commits; after any nontrivial change, update TODO.md and DECISIONS.log.
- If instructions conflict, ask briefly in chat AND propose the safest default path in PLAN.md.


# CONTINUOUS EXECUTION ACROSS PHASES

- Do **not** stop or wait for user confirmation at the end of a Phase.
- When the last task of a Phase in `TODO.md` is completed, **immediately continue to the next Phase**.
- Before advancing, **re-read** `PLAN.md`, `DECISIONS.log`, and `TODO.md` to refresh context and detect changes.
- **Only pause** if:
  - Credentials/secrets are required and cannot be safely stubbed.
  - An action is destructive (e.g., dropping data) and explicit consent is needed.
  - Requirements conflict and cannot be resolved from `PRODUCT_BRIEF/blueprint.md`.

## Reporting (don’t block)
- After each Phase, post a brief **Phase Summary** (1–4 lines: what was done, key files, next Phase starting now), then **continue automatically**.
